(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{164:function(e,t,n){},183:function(e,t,n){e.exports=n(374)},198:function(e,t,n){},270:function(e,t,n){},374:function(e,t,n){"use strict";n.r(t);var a=n(28),o=n(29),r=n(32),c=n(30),s=n(33),i=n(1),u=n.n(i),l=n(9),p=n.n(l),d=n(31),h=n(37),m=n(161),f=n(121),g=n(125),C=n(34),v="SET_APP_READY",y="GET_COUPONS_FROM_BASE",b="GET_INIT_COUPONS_FROM_BASE",O="SET_ACTIVE_COUPON",E="OPEN_COPY_MODAL",j="CLOSE_COPY_MODAL",k="GET_STORE_LANG",w="GET_CURRENCY",S={selectedCoupon:"",coupons:[],isCouponsLoaded:!0,isCouponsLoading:!1,aplication:{ready:!1},modal:{show:!1},storeLang:"",currency:""},R=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:S,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case b:return Object(C.a)({},e,{isCouponsLoading:!0});case y:return Object(C.a)({},e,{coupons:Object(g.a)(e.coupons).concat(Object(g.a)(t.payload.items)),isCouponsLoaded:t.payload.total===e.coupons.length,isCouponsLoading:!1});case E:case j:return Object(C.a)({},e,{modal:{show:t.payload}});case v:return Object(C.a)({},e,{aplication:{ready:t.payload}});case O:return Object(C.a)({},e,{selectedCoupon:t.payload});case k:return Object(C.a)({},e,{storeLang:t.payload});default:return e}},T=Object(h.c)({couponReducer:R}),x=n(122),L=n.n(x),_=Object(m.createLogger)(),P=(Object(h.d)(T,Object(h.a)(_,f.a,L.a)),Object(h.d)(T,Object(h.a)(f.a,L.a))),A=n(22),M=(n(198),n(60)),N=n.n(M),D=n(162),I=n.n(D);function U(e,t){N.a.isString(t)&&(t=[t]),t.forEach(function(t){return e[t]=e[t].bind(e)})}document.createElement("table"),document.createElement("tr"),document.createElement("th"),document.createElement("td");function G(e,t){var n=function(e,t){return"<div>\n        <h1>".concat(e,'</h1>\n          <div style="padding: 20px;\n                      background: rgba(0,0,0,.1);\n                      border-radius: 8px;\n                      margin-bottom: 40px;"\n          >\n            ').concat(t,"\n          </div>\n      </div>\n      ")},a=n("JSON: ".concat(t),JSON.stringify(e)),o=n("CSV: ".concat(t),function(e,t,n){var a="object"!=typeof e?JSON.parse(e):e,o="";if(o+=t+"\r\n\n",n){var r="";for(var c in a[0])r+=c+",";o+=(r=r.slice(0,-1))+"\r\n"}for(var s=0;s<a.length;s++){for(var c in r="",a[s])r+=a[s][c]+",";r.slice(0,r.length-1),o+=r+"\r\n"}if(""!=o)return o;alert("Invalid data")}(e,t)),r=n("TABLE: ".concat(t),I()(e)),c="<html>\n      <head>\n        <style>\n          table{\n            border-collapse: collapse;\n          }\n          td,th{\n            border: 1px solid gray;\n            padding: 5px;\n          }\n        </style>\n      </head>\n      <body>\n        ".concat(a,"\n        ").concat(o,"\n        ").concat(r,"\n      </body>\n    </html>"),s="data:text/html;charset=utf8,"+encodeURIComponent(c);window.open(s)}var B=n(163),F=n.n(B),Y=n(52),J=n.n(Y),V=window.EcwidApp;V.init({app_id:"coupon-generator",autoloadedflag:!0,autoheight:!0});var W=V.getPayload(),$=W.store_id,H=W.access_token,z=window.EcwidApp;function K(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return function(t){t({type:b}),J.a.get("https://app.ecwid.com/api/v3/".concat($,"/discount_coupons?token=").concat(H,"&offset=").concat(e)).then(function(e){t({type:y,payload:e.data})})}}var X=n(164),q=n.n(X),Q=n(82),Z=n(20),ee=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(r.a)(this,Object(c.a)(t).call(this,e))).downloadCsv=function(){var e=n.getActiveSetCoupons(),t=[];for(var a in e[0])e[0].hasOwnProperty(a)&&a.length>0&&t.push(a);try{var o=F()({data:e,fields:t});o.match(/^data:text\/csv/i)||(o="data:text/csv;charset=utf-8,"+o),o=encodeURI(o);var r=document.createElement("a");r.setAttribute("href",o),r.setAttribute("download","coupons.csv"),r.click()}catch(c){}},n.state={lang:""},U(Object(A.a)(Object(A.a)(n)),["openModal","printCoupons","getActiveSetCoupons","getTranslate"]),n}return Object(s.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){this.setState({lang:this.props.storeLang})}},{key:"componentWillReceiveProps",value:function(){this.setState({lang:this.props.storeLang})}},{key:"openModal",value:function(){this.props.openCopyModal()}},{key:"printCoupons",value:function(){G(this.getActiveSetCoupons(),this.props.selectedCoupon.name)}},{key:"getActiveSetCoupons",value:function(){var e=this,t=[];return this.props.coupons.forEach(function(n,a){n.name===e.props.selectedCoupon.name&&t.push(n)}),t}},{key:"getTranslate",value:function(e){return{en:{title:"Please select coupon you want to manage",copy:"Copy coupon",print:"Print coupon",downloadCsv:"Download CSV"},ru:{title:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043a\u0443\u043f\u043e\u043d",copy:"\u041a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043a\u0443\u043f\u043e\u043d\u044b",print:"\u0420\u0430\u0441\u043f\u0435\u0447\u0430\u0442\u0430\u0442\u044c \u043a\u0443\u043f\u043e\u043d\u044b",downloadCsv:"\u0421\u043a\u0430\u0447\u0430\u0442\u044c CSV"}}["ru"===this.state.lang?"ru":"en"][e]}},{key:"render",value:function(){return u.a.createElement("aside",{className:q.a.Aside,style:{paddingTop:100}},u.a.createElement("div",{style:{padding:10,background:"#fff"}},u.a.createElement("h2",null,this.getTranslate("title")),u.a.createElement("div",null,u.a.createElement(Q.a,{onClick:this.openModal,disabled:Z.e(this.props.selectedCoupon)},this.getTranslate("copy"))),u.a.createElement("br",null),u.a.createElement("div",null,u.a.createElement(Q.a,{onClick:this.printCoupons,disabled:Z.e(this.props.selectedCoupon)},this.getTranslate("print"))),u.a.createElement("br",null),u.a.createElement("div",null,u.a.createElement(Q.a,{onClick:this.downloadCsv,disabled:Z.e(this.props.selectedCoupon)},this.getTranslate("downloadCsv")))))}}]),t}(u.a.Component);var te=Object(d.b)(function(e){return{modal:e.couponReducer.modal,selectedCoupon:e.couponReducer.selectedCoupon,coupons:e.couponReducer.coupons,storeLang:e.couponReducer.storeLang}},{openCopyModal:function(){return{type:E,payload:!0}}})(ee),ne=n(166),ae=n(378),oe=n(375),re=n(380),ce=n(167),se=n.n(ce),ie=(n(270),["name","status","code"]),ue=ae.a.Search,le=[{title:"Name",dataIndex:"name"},{title:"Discount Type",dataIndex:"discountType"},{title:"Time",dataIndex:"id",render:function(e,t,n){return t.expirationDate?se()(t.expirationDate).format("MMM D YYYY"):"until deactivated"}},{title:"Status",dataIndex:"status",render:function(e,t){var n=t.status;return u.a.createElement("span",{className:function(e){switch(e){case"ACTIVE":return"active";case"PAUSED":return"paused";case"EXPIRED":return"expired";case"USEDUP":return"usedup";default:return}}(n)},n)}}];var pe=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(r.a)(this,Object(c.a)(t).call(this,e))).state={searchTerm:""},U(Object(A.a)(Object(A.a)(n)),["makeCoupons","mekeCouponsGroups","componentDidMount","searchUpdated","getSearchPlaceholder"]),n}return Object(s.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){this.props.getCouponsFromBase(),this.props.aplication.ready||this.props.setAppReady()}},{key:"componentWillReceiveProps",value:function(e){e.isCouponsLoaded||this.props.getCouponsFromBase(e.coupons.length),e.isCouponsLoaded}},{key:"mekeCouponsGroups",value:function(e){var t={};return e.sort(function(e,t){var n=new Date(e.updateDate);return new Date(t.updateDate)-n}).forEach(function(e,n){t[e.name]||(t[e.name]=[]),t[e.name].push(e)}),t}},{key:"makeCoupons",value:function(e){var t=this;if(N.a.isObject(e)){var n=this.state.search,a=Z.g(Z.c(Z.h("name")),Z.j,Z.b(function(e){return!n||0===n.length||Z.a(function(t){return Z.a(function(e){return N.a.includes(Z.i(e[t]),Z.i(n))},e)},ie)}),Z.f(function(e){return{name:e[0].name,discountType:e[0].discountType,id:e[0].id,status:e[0].status,data:e}})),o={selectedRowKeys:this.props.selectedCoupon.name,type:"radio",onChange:function(e,n){t.props.setActiveCoupon(Z.d(n))}};return u.a.createElement(oe.a,{rowSelection:o,rowKey:function(e){return e.name},loading:!this.props.isCouponsLoaded,columns:le,dataSource:a(e),size:"small",expandedRowRender:function(e){return e.data.map(function(e){return u.a.createElement(re.a,{color:"blue",key:e.code},e.code)})},pagination:{defaultPageSize:30},onRow:function(e){return{onClick:function(){t.props.setActiveCoupon(e)}}}})}}},{key:"searchUpdated",value:function(e){this.setState({searchTerm:e})}},{key:"getSearchPlaceholder",value:function(){return"ru"===this.props.storeLang?"\u041f\u043e\u0438\u0441\u043a":"Search"}},{key:"render",value:function(){var e=this,t=this.props.coupons.filter(Object(ne.createFilter)(this.state.searchTerm,ie));return u.a.createElement("div",null,u.a.createElement(ue,{placeholder:this.getSearchPlaceholder(),onSearch:function(t){return e.setState({search:t})},onChange:function(t){return e.setState({search:t.target.value})},style:{width:300}}),u.a.createElement("br",null),u.a.createElement("br",null),this.makeCoupons(t))}}]),t}(u.a.Component);var de=Object(d.b)(function(e){return{coupons:e.couponReducer.coupons,aplication:e.couponReducer.aplication,selectedCoupon:e.couponReducer.selectedCoupon,isCouponsLoaded:e.couponReducer.isCouponsLoaded,storeLang:e.couponReducer.storeLang}},{getCouponsFromBase:K,setAppReady:function(){return{type:v,payload:!0}},setActiveCoupon:function(e){return{type:O,payload:e}}})(pe),he=n(63),me=n.n(he),fe=n(176),ge=n.n(fe),Ce=n(377),ve=n(376),ye=n(83),be=new ge.a,Oe=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(r.a)(this,Object(c.a)(t).call(this,e))).state={show:!0,copyConfig:{amount:0,prefix:"myStore--",random:!0,valid:!1}},U(Object(A.a)(Object(A.a)(n)),["closeModal","handleChangeNumber","handleChangeprefix","handleChangeRandom","submitGenerator","getRandomCode","getTranslate"]),n}return Object(s.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){}},{key:"closeModal",value:function(){this.props.closeCopyModal()}},{key:"handleChangeNumber",value:function(e){var t=Math.abs(e.target.value)<50?Math.abs(e.target.value):50;this.setState(function(e){return e.copyConfig.amount=t,e})}},{key:"handleChangeprefix",value:function(e){var t=e.target.value;this.setState(function(e){return e.copyConfig.prefix=t,e})}},{key:"handleChangeRandom",value:function(){this.setState(function(e){return e.copyConfig.random=!e.copyConfig.random,e})}},{key:"getRandomCode",value:function(e){return be.hash({length:e})}},{key:"submitGenerator",value:function(){var e=this;if(0==this.state.copyConfig.amount||0==this.state.copyConfig.prefix.length)return alert("Please insert correct form data");for(var t=[],n=1;n<=this.state.copyConfig.amount;n++){var a="";a=this.state.copyConfig.random?this.getRandomCode(12):"".concat(this.state.copyConfig.prefix,"-").concat(this.getRandomCode(5)),t.push(J.a.post("https://app.ecwid.com/api/v3/".concat($,"/discount_coupons?token=").concat(H),Object(C.a)({},this.props.selectedCoupon,{code:a})))}J.a.all(t).then(function(t){e.props.getCouponsFromBase()}).then(this.closeModal()).catch(function(e){return console.error(e)})}},{key:"getTranslate",value:function(e){return{en:{title:"Choose the coupon code prefix and the number of codes",random:"Random code:",prefix:"Prefix:",amount:"Amount:",button:"Generate coupons"},ru:{title:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043f\u0440\u0435\u0444\u0438\u043a\u0441 \u0434\u043b\u044f \u043a\u043e\u0434\u0430 \u0438 \u0438\u0445 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e",random:"\u0421\u043b\u0443\u0447\u0430\u0439\u043d\u044b\u0439 \u043a\u043e\u0434:",prefix:"\u041f\u0440\u0435\u0444\u0438\u043a\u0441:",amount:"\u041a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e:",button:"\u0421\u0433\u0435\u043d\u0435\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c"}}["ru"===this.props.storeLang?"ru":"en"][e]}},{key:"render",value:function(){var e={labelCol:{xs:{span:24},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:8}}};return u.a.createElement(Ce.a,{visible:this.props.modal.show,onCancel:this.closeModal,footer:null},u.a.createElement("div",{className:"".concat(me.a.mainPopup," ").concat(me.a.mainPopup_center)},u.a.createElement("div",{className:me.a.mainPopup__container},u.a.createElement("h3",{className:me.a.mainPopup__title},this.getTranslate("title")),u.a.createElement(ve.a.Item,Object.assign({label:this.getTranslate("random")+" "},e),u.a.createElement(ye.a,{checked:this.state.copyConfig.random,onChange:this.handleChangeRandom})),this.state.copyConfig.random?"":u.a.createElement(ve.a.Item,Object.assign({label:this.getTranslate("prefix")},e),u.a.createElement(ae.a,{type:"string",className:"form-control input-medium",placeholder:"MyCoupon-$$$",value:this.state.copyConfig.prefix,onChange:this.handleChangeprefix,disabled:this.state.copyConfig.random})),u.a.createElement(ve.a.Item,Object.assign({label:this.getTranslate("amount")},e),u.a.createElement(ae.a,{type:"number",className:"form-control input-medium",placeholder:"0",value:this.state.copyConfig.amount,onChange:this.handleChangeNumber,max:"50"})),u.a.createElement("div",{className:me.a.mainPopup__buttons},u.a.createElement(Q.a,{className:"btn btn-primary btn-medium",onClick:this.submitGenerator,disabled:Z.e(this.props.selectedCoupon)},this.getTranslate("button"))))))}}]),t}(u.a.Component);var Ee=Object(d.b)(function(e){return{modal:e.couponReducer.modal,selectedCoupon:e.couponReducer.selectedCoupon,storeLang:e.couponReducer.storeLang}},{closeCopyModal:function(){return{type:j,payload:!1}},generateCoupons:function(e,t){return function(e){J.a.post("https://app.ecwid.com/api/v3/".concat($,"/discount_coupons?token=").concat(H),{}).then(function(t){e({type:y,payload:t})})}},getCouponsFromBase:K})(Oe),je=n(379),ke=(je.a.Header,je.a.Footer,je.a.Sider),we=je.a.Content,Se=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(r.a)(this,Object(c.a)(t).call(this,e))).state={data:""},U(Object(A.a)(Object(A.a)(n)),["getTranslate"]),n}return Object(s.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){this.props.getSoreLang(),this.props.getCurency()}},{key:"getTranslate",value:function(e){return{en:{title:"Coupon Manager"},ru:{title:"\u041c\u0435\u043d\u0435\u0434\u0436\u0435\u0440 \u041a\u0443\u043f\u043e\u043d\u043e\u0432"}}["ru"===this.props.storeLang?"ru":"en"][e]}},{key:"render",value:function(){return u.a.createElement(je.a,{style:{minHeight:"100vh"}},u.a.createElement(we,{style:{padding:"0 50px",marginTop:64}},u.a.createElement("h1",null,this.getTranslate("title")),u.a.createElement("div",{style:{background:"#fff",padding:24,minHeight:380}},u.a.createElement(de,null))),u.a.createElement(ke,{theme:"light"},u.a.createElement(te,null),u.a.createElement(Ee,null)))}}]),t}(u.a.Component);var Re=Object(d.b)(function(e){return{storeLang:e.couponReducer.storeLang}},{getSoreLang:function(){var e=z.getPayload();return{type:k,payload:e.lang}},getCurency:function(){return function(e){return J()("https://app.ecwid.com/api/v3/".concat($,"/profile?token=").concat(H)).then(function(t){return e({type:w,payload:t.data.formatsAndUnits.currency})})}}})(Se);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var Te=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(r.a)(this,Object(c.a)(t).call(this,e))).state={},n}return Object(s.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return u.a.createElement(d.a,{store:P},u.a.createElement(Re,null))}}]),t}(u.a.Component);p.a.render(u.a.createElement(Te,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},63:function(e,t,n){}},[[183,2,1]]]);
//# sourceMappingURL=main.57ece02a.chunk.js.map