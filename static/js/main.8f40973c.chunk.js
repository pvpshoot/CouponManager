(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{178:function(e,t,n){},198:function(e,t,n){e.exports=n(404)},213:function(e,t,n){},299:function(e,t,n){},399:function(e,t,n){},404:function(e,t,n){"use strict";n.r(t);var a=n(33),o=n(34),c=n(37),r=n(35),i=n(36),s=n(1),u=n.n(s),l=n(9),p=n.n(l),d=n(25),m=n(44),h=n(138),f=n(84),g=n(39),y="SET_APP_READY",v="GET_COUPONS_FROM_BASE",C="GET_INIT_COUPONS_FROM_BASE",b="SET_ACTIVE_COUPON",E="OPEN_COPY_MODAL",O="CLOSE_COPY_MODAL",j="GET_STORE_LANG",w="GET_CURRENCY",k="SHOW_PRINT",S="HIDE_PRINT",_=n(16),R={selectedCoupon:"",coupons:[],isCouponsLoaded:!0,isCouponsLoading:!1,print:!1,aplication:{ready:!1},modal:{show:!1},storeLang:"",currency:""},x=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:R,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case C:return Object(g.a)({},e,{isCouponsLoading:!0});case v:var n=_.j(function(e,t){return e.name===t.name&&e.id===t.id},Object(f.a)(e.coupons).concat(Object(f.a)(t.payload.items)));return Object(g.a)({},e,{coupons:n,isCouponsLoaded:t.payload.total===Object(f.a)(e.coupons).concat(Object(f.a)(t.payload.items)).length||0===t.payload.count,isCouponsLoading:!1,total:t.payload.total});case E:case O:return Object(g.a)({},e,{modal:{show:t.payload}});case y:return Object(g.a)({},e,{aplication:{ready:t.payload}});case b:return Object(g.a)({},e,{selectedCoupon:t.payload});case j:return Object(g.a)({},e,{storeLang:t.payload});case k:return Object(g.a)({},e,{print:!0});case S:return Object(g.a)({},e,{print:!1});default:return e}},P=Object(m.c)({couponReducer:x}),L=n(139),A=n.n(L),M=(Object(m.d)(P,Object(m.a)(h.a,A.a)),Object(m.d)(P,Object(m.a)(h.a,A.a))),N=(n(213),n(73)),T=n.n(N),D=n(98),I=n.n(D);function K(e,t){T.a.isString(t)&&(t=[t]),t.forEach(function(t){return e[t]=e[t].bind(e)})}function F(e,t,n){var a="object"!=typeof e?JSON.parse(e):e,o="";if(o+=t+"\r\n\n",n){var c="";for(var r in a[0])c+=r+",";o+=(c=c.slice(0,-1))+"\r\n"}for(var i=0;i<a.length;i++){c="";for(var r in a[i])c+=a[i][r]+",";c.slice(0,c.length-1),o+=c+"\r\n"}if(""!=o)return o;alert("Invalid data")}document.createElement("table"),document.createElement("tr"),document.createElement("th"),document.createElement("td");var B=n(40),U=n(177),G=n(65),Y=n.n(G),J=window.EcwidApp;J.init({app_id:"multiple-coupons-dev",autoloadedflag:!0,autoheight:!0});var V=J.getPayload(),H=V.store_id,W=V.access_token,$=n(108),z=window.EcwidApp;function q(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return function(t){t({type:C}),Y.a.get("https://app.ecwid.com/api/v3/".concat(H,"/discount_coupons?token=").concat(W,"&offset=").concat(e)).then(function(e){t({type:v,payload:e.data})})}}function X(){return{type:E,payload:!0}}function Q(e){return{type:b,payload:e}}var Z=n(178),ee=n.n(Z),te=n(61),ne=n(14),ae=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(c.a)(this,Object(r.a)(t).call(this,e))).downloadCsv=function(){var e=n.getActiveSetCoupons(),t=[];for(var a in e[0])e[0].hasOwnProperty(a)&&a.length>0&&t.push(a);try{var o=new U.Parser({fields:t}).parse(e);o.match(/^data:text\/csv/i)||(o="data:text/csv;charset=utf-8,"+o),o=encodeURI(o);var c=document.createElement("a");c.setAttribute("href",o),c.setAttribute("download","coupons.csv"),c.click()}catch(r){console.error(r)}},n.state={lang:""},K(Object(B.a)(Object(B.a)(n)),["openModal","printCoupons","getActiveSetCoupons","getTranslate"]),n}return Object(i.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){this.setState({lang:this.props.storeLang})}},{key:"componentWillReceiveProps",value:function(){this.setState({lang:this.props.storeLang})}},{key:"openModal",value:function(){this.props.openCopyModal()}},{key:"printCoupons",value:function(){!function(e,t){var n=function(e,t){return"<div>\n        <h1>".concat(e,'</h1>\n          <div style="padding: 20px;\n                      background: rgba(0,0,0,.1);\n                      border-radius: 8px;\n                      margin-bottom: 40px;"\n          >\n            ').concat(t,"\n          </div>\n      </div>\n      ")},a=n("JSON: ".concat(t),JSON.stringify(e)),o=n("CSV: ".concat(t),F(e,t)),c=n("TABLE: ".concat(t),I()(e)),r="<html>\n      <head>\n        <style>\n          table{\n            border-collapse: collapse;\n          }\n          td,th{\n            border: 1px solid gray;\n            padding: 5px;\n          }\n        </style>\n      </head>\n      <body>\n        ".concat(a,"\n        ").concat(o,"\n        ").concat(c,"\n      </body>\n    </html>"),i="data:text/html;charset=utf8,"+encodeURIComponent(r);window.open(i)}(this.getActiveSetCoupons(),this.props.selectedCoupon.name)}},{key:"getActiveSetCoupons",value:function(){var e=this,t=[];return this.props.coupons.forEach(function(n,a){n.name===e.props.selectedCoupon.name&&t.push(n)}),t}},{key:"getTranslate",value:function(e){return{en:{title:"Please select coupon you want to manage",copy:"Copy coupon",print:"Print coupon",downloadCsv:"Download CSV"},ru:{title:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043a\u0443\u043f\u043e\u043d",copy:"\u041a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043a\u0443\u043f\u043e\u043d\u044b",print:"\u0420\u0430\u0441\u043f\u0435\u0447\u0430\u0442\u0430\u0442\u044c \u043a\u0443\u043f\u043e\u043d\u044b",downloadCsv:"\u0421\u043a\u0430\u0447\u0430\u0442\u044c CSV"}}["ru"===this.state.lang?"ru":"en"][e]}},{key:"render",value:function(){var e=window.location.hash;return u.a.createElement("aside",{className:ee.a.Aside,style:{paddingTop:100}},u.a.createElement("div",{style:{padding:10,background:"#fff"}},u.a.createElement("h2",null,u.a.createElement(ne.a,{i18nKey:"aside.title"})),u.a.createElement("div",null,u.a.createElement(te.a,{onClick:this.openModal,disabled:_.e(this.props.selectedCoupon)},u.a.createElement(ne.a,{i18nKey:"aside.copy"}))),u.a.createElement("br",null),u.a.createElement("div",null,u.a.createElement(te.a,{onClick:this.props.showPrint,disabled:_.e(this.props.selectedCoupon)},u.a.createElement(ne.a,{i18nKey:"aside.print"}))),u.a.createElement("br",null),u.a.createElement("div",null,u.a.createElement(te.a,{onClick:this.downloadCsv,disabled:_.e(this.props.selectedCoupon)},u.a.createElement(ne.a,{i18nKey:"aside.download_\u0441sv"}))),u.a.createElement("br",null),u.a.createElement("div",null,u.a.createElement(te.a,{type:"primary",href:"https://pvpshoot.github.io/couponManager__Build/couponManager/app.html?".concat(e)},u.a.createElement(ne.a,{i18nKey:"aside.old_design"})))))}}]),t}(u.a.Component);var oe=Object(d.b)(function(e){return{modal:e.couponReducer.modal,selectedCoupon:e.couponReducer.selectedCoupon,coupons:e.couponReducer.coupons,storeLang:e.couponReducer.storeLang}},{openCopyModal:X,showPrint:function(){return{type:k}}})(ae),ce=n(182),re=n(409),ie=n(405),se=n(408),ue=n(183),le=n.n(ue);n(299);function pe(e){return u.a.createElement(te.a,{onClick:function(){e.setActiveCoupon(e.coupon),e.openCopyModal()}},e.children)}pe.defaultProps={children:"Copy"};var de=Object(d.b)(null,{setActiveCoupon:Q,openCopyModal:X})(pe),me=["name","status","code"],he=re.a.Search;var fe=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(c.a)(this,Object(r.a)(t).call(this,e))).columns=[{title:u.a.createElement(ne.a,{i18nKey:"main.name"}),dataIndex:"name"},{title:u.a.createElement(ne.a,{i18nKey:"main.discount_type"}),dataIndex:"discountType"},{title:u.a.createElement(ne.a,{i18nKey:"main.time"}),dataIndex:"id",render:function(e,t,n){return t.expirationDate?le()(t.expirationDate).format("MMM D YYYY"):"until deactivated"}},{title:u.a.createElement(ne.a,{i18nKey:"main.status"}),dataIndex:"status",render:function(e,t){var n=t.status;return u.a.createElement("span",{className:function(e){switch(e){case"ACTIVE":return"active";case"PAUSED":return"paused";case"EXPIRED":return"expired";case"USEDUP":return"usedup";default:return}}(n)},n)}},{title:u.a.createElement(ne.a,{i18nKey:"main.action"}),render:function(e,t){return u.a.createElement(de,{coupon:t},u.a.createElement(ne.a,{i18nKey:"main.copy"}))}}],n.throttle=function(e,t,n){n=n||window;var a=!1;n.addEventListener(e,function(){a||(a=!0,requestAnimationFrame(function(){n.dispatchEvent(new CustomEvent(t)),a=!1}))})},n.makeCoupons=function(e){if(T.a.isObject(e)){var t=n.state.search,a=_.g(_.c(_.h("name")),_.k,_.b(function(e){return!t||0===t.length||_.a(function(n){return _.a(function(e){return T.a.includes(_.i(e[n]),_.i(t))},e)},me)}),_.f(function(e){return{name:e[0].name,discountType:e[0].discountType,id:e[0].id,status:e[0].status,data:e}})),o={selectedRowKeys:n.props.selectedCoupon.name,type:"radio",onChange:function(e,t){n.props.setActiveCoupon(_.d(t))}};return u.a.createElement(ie.a,{rowSelection:o,rowKey:function(e){return e.name},scroll:{x:!0},loading:!n.props.isCouponsLoaded,columns:n.columns,dataSource:a(e),size:"small",expandedRowRender:function(e){return u.a.createElement("ul",{style:{columnCount:4}},e.data.map(function(e){return u.a.createElement("li",{key:e.code},e.code)}))},pagination:{defaultPageSize:30},onRow:function(e){return{onClick:function(){n.props.setActiveCoupon(e)}}}})}},n.renderProgress=function(){var e=n.props,t=(e.isCouponsLoaded,e.total),a=e.coupons;return u.a.createElement(se.a,{percent:Math.floor(100*a.length/t)})},n.state={searchTerm:""},K(Object(B.a)(Object(B.a)(n)),["makeCoupons","mekeCouponsGroups","componentDidMount","searchUpdated"]),n}return Object(i.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){this.props.getCouponsFromBase(),this.props.aplication.ready||this.props.setAppReady()}},{key:"componentWillReceiveProps",value:function(e){e.isCouponsLoaded||this.props.getCouponsFromBase(e.coupons.length),e.isCouponsLoaded}},{key:"mekeCouponsGroups",value:function(e){var t={};return e.sort(function(e,t){var n=new Date(e.updateDate);return new Date(t.updateDate)-n}).forEach(function(e,n){t[e.name]||(t[e.name]=[]),t[e.name].push(e)}),t}},{key:"searchUpdated",value:function(e){this.setState({searchTerm:e})}},{key:"render",value:function(){var e=this,t=this.props.t,n=this.props.coupons.filter(Object(ce.createFilter)(this.state.searchTerm,me));return u.a.createElement("div",null,u.a.createElement(he,{placeholder:t("main.search"),onSearch:function(t){return e.setState({search:t})},onChange:function(t){return e.setState({search:t.target.value})},style:{width:300}}),u.a.createElement("br",null),this.renderProgress(),u.a.createElement("br",null),this.makeCoupons(n))}}]),t}(u.a.Component);var ge=_.g(Object(d.b)(function(e){return{coupons:e.couponReducer.coupons,aplication:e.couponReducer.aplication,selectedCoupon:e.couponReducer.selectedCoupon,isCouponsLoaded:e.couponReducer.isCouponsLoaded,storeLang:e.couponReducer.storeLang,total:e.couponReducer.total}},{getCouponsFromBase:q,setAppReady:function(){return{type:y,payload:!0}},setActiveCoupon:Q}),Object(ne.c)("translation"))(fe),ye=n(75),ve=n.n(ye),Ce=n(191),be=n.n(Ce),Ee=n(411),Oe=n(407),je=n(406),we=n(64),ke=new be.a,Se=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(c.a)(this,Object(r.a)(t).call(this,e))).state={show:!0,copyConfig:{amount:0,prefix:"myStore--",random:!0,valid:!1}},K(Object(B.a)(Object(B.a)(n)),["closeModal","handleChangeNumber","handleChangeprefix","handleChangeRandom","submitGenerator","getRandomCode"]),n}return Object(i.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){}},{key:"closeModal",value:function(){this.props.closeCopyModal()}},{key:"handleChangeNumber",value:function(e){var t=Math.abs(e.target.value)<50?Math.abs(e.target.value):50;this.setState(function(e){return e.copyConfig.amount=t,e})}},{key:"handleChangeprefix",value:function(e){var t=e.target.value;this.setState(function(e){return e.copyConfig.prefix=t,e})}},{key:"handleChangeRandom",value:function(){this.setState(function(e){return e.copyConfig.random=!e.copyConfig.random,e})}},{key:"getRandomCode",value:function(e){return ke.hash({length:e})}},{key:"submitGenerator",value:function(){var e=this;if(0==this.state.copyConfig.amount||0==this.state.copyConfig.prefix.length)return alert("Please insert correct form data");for(var t=[],n=1;n<=this.state.copyConfig.amount;n++){var a="";a=this.state.copyConfig.random?this.getRandomCode(12):"".concat(this.state.copyConfig.prefix,"-").concat(this.getRandomCode(5)),t.push(Y.a.post("https://app.ecwid.com/api/v3/".concat(H,"/discount_coupons?token=").concat(W),Object(g.a)({},this.props.selectedCoupon,{code:a})))}Ee.a.info({message:"Copying ".concat(t.length," coupons"),duration:0}),Y.a.all(t).then(function(){Ee.a.success({message:"Finished copying coupons!"}),setTimeout(function(){return document.location.reload()},1e3)}).then(function(t){e.props.getCouponsFromBase()}).then(this.closeModal()).catch(function(e){return console.error(e)})}},{key:"render",value:function(){var e={labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:8}}};return u.a.createElement(Oe.a,{visible:this.props.modal.show,onCancel:this.closeModal,footer:null},u.a.createElement("div",{className:"".concat(ve.a.mainPopup," ").concat(ve.a.mainPopup_center)},u.a.createElement("div",{className:ve.a.mainPopup__container},u.a.createElement("h3",{className:ve.a.mainPopup__title},u.a.createElement(ne.a,{i18nKey:"copy_modal.title"})),u.a.createElement(je.a.Item,Object.assign({label:u.a.createElement(ne.a,{i18nKey:"copy_modal.random"})},e),u.a.createElement(we.a,{checked:this.state.copyConfig.random,onChange:this.handleChangeRandom})),this.state.copyConfig.random?"":u.a.createElement(je.a.Item,Object.assign({label:u.a.createElement(ne.a,{i18nKey:"copy_modal.prefix"})},e),u.a.createElement(re.a,{type:"string",className:"form-control input-medium",placeholder:"MyCoupon-$$$",value:this.state.copyConfig.prefix,onChange:this.handleChangeprefix,disabled:this.state.copyConfig.random})),u.a.createElement(je.a.Item,Object.assign({label:u.a.createElement(ne.a,{i18nKey:"copy_modal.amount"})},e),u.a.createElement(re.a,{type:"number",className:"form-control input-medium",placeholder:"0",value:this.state.copyConfig.amount,onChange:this.handleChangeNumber,max:"50"})),u.a.createElement("div",{className:ve.a.mainPopup__buttons},u.a.createElement(te.a,{className:"btn btn-primary btn-medium",onClick:this.submitGenerator,disabled:_.e(this.props.selectedCoupon)},u.a.createElement(ne.a,{i18nKey:"copy_modal.button"}))))))}}]),t}(u.a.Component);var _e=Object(d.b)(function(e){return{modal:e.couponReducer.modal,selectedCoupon:e.couponReducer.selectedCoupon,storeLang:e.couponReducer.storeLang}},{closeCopyModal:function(){return{type:O,payload:!1}},generateCoupons:function(e,t){return function(e){Y.a.post("https://app.ecwid.com/api/v3/".concat(H,"/discount_coupons?token=").concat(W),{}).then(function(t){e({type:v,payload:t})})}},getCouponsFromBase:q})(Se),Re=n(410);var xe=function(e){function t(){var e,n;Object(a.a)(this,t);for(var o=arguments.length,i=new Array(o),s=0;s<o;s++)i[s]=arguments[s];return(n=Object(c.a)(this,(e=Object(r.a)(t)).call.apply(e,[this].concat(i)))).getActiveSetCoupons=function(){var e=[];return n.props.coupons.forEach(function(t,a){t.name===n.props.selectedCoupon.name&&e.push(t)}),e},n}return Object(i.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this.props.selectedCoupon.name,t=this.getActiveSetCoupons();return u.a.createElement("div",null,u.a.createElement(te.a,{onClick:this.props.hidePrint},"Go back"),u.a.createElement("div",{dangerouslySetInnerHTML:{__html:function(e,t){var n=function(e,t){return"<div>\n          <h1>".concat(e,'</h1>\n            <div style="padding: 20px;\n                        background: rgba(0,0,0,.1);\n                        border-radius: 8px;\n                        margin-bottom: 40px;"\n            >\n              ').concat(t,"\n            </div>\n        </div>\n        ")},a=n("JSON: ".concat(t),JSON.stringify(e)),o=n("CSV: ".concat(t),F(e,t)),c=n("TABLE: ".concat(t),I()(e));return"\n          ".concat(a,"\n          ").concat(o,"\n          ").concat(c,"\n    ")}(t,e)}}))}}]),t}(u.a.Component),Pe=Object(d.b)(function(e){return{selectedCoupon:e.couponReducer.selectedCoupon,coupons:e.couponReducer.coupons}},{hidePrint:function(){return{type:S}}})(xe),Le=(n(399),Re.a.Header,Re.a.Footer,Re.a.Sider),Ae=Re.a.Content,Me=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(c.a)(this,Object(r.a)(t).call(this,e))).state={data:""},n}return Object(i.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){this.props.getSoreLang(),this.props.getCurency()}},{key:"renderContent",value:function(){return this.props.print?u.a.createElement(Pe,null):u.a.createElement(s.Fragment,null,u.a.createElement(Ae,{className:"container"},u.a.createElement("h1",null,u.a.createElement(ne.a,{i18nKey:"title"})),u.a.createElement("div",{style:{background:"#fff",padding:24,minHeight:380}},u.a.createElement(ge,null))),u.a.createElement(Le,{theme:"light"},u.a.createElement(oe,null),u.a.createElement(_e,null)))}},{key:"render",value:function(){return u.a.createElement(Re.a,{style:{minHeight:"100vh"}},this.renderContent())}}]),t}(u.a.Component);var Ne=_.g(Object(d.b)(function(e){return{storeLang:e.couponReducer.storeLang,print:e.couponReducer.print}},{getSoreLang:function(){var e=z.getPayload();return $.a.changeLanguage(e.lang),{type:j,payload:e.lang}},getCurency:function(){return function(e){return Y()("https://app.ecwid.com/api/v3/".concat(H,"/profile?token=").concat(W)).then(function(t){return e({type:w,payload:t.data.formatsAndUnits.currency})})}}}),Object(ne.c)("translation"))(Me);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var Te=n(196),De=n.n(Te);console.log("%c info %c ".concat(window.location.pathname.replace("/",""),"locales/{{lng}}/{{ns}}.json %c !!! "),"background-color: #1E88E5; color: #fff; padding: 2px; font-weight: bold;","background-color: #90CAF9; padding: 2px;","background-color: #1E88E5; color: #fff; padding: 2px; font-weight: bold;"),$.a.use(De.a).use(ne.b).init({fallbackLng:"en",debug:!0,backend:{loadPath:"locales/{{lng}}/{{ns}}.json"},interpolation:{escapeValue:!1},react:{wait:!0}});var Ie=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(c.a)(this,Object(r.a)(t).call(this,e))).state={},n}return Object(i.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return u.a.createElement(d.a,{store:M},u.a.createElement(Ne,null))}}]),t}(u.a.Component);p.a.render(u.a.createElement(Ie,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},75:function(e,t,n){}},[[198,2,1]]]);
//# sourceMappingURL=main.8f40973c.chunk.js.map